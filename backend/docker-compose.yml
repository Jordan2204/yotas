version: '3'

services:
  postgres:
    image: postgres
    restart: always
    environment:
      POSTGRES_DB: yotas
      POSTGRES_PASSWORD: yotas
      POSTGRES_USER: yotas
    ports:
      - 5432:5432
    volumes:
      - ./postgres-data:/var/lib/postgresql/data

  start-postgres:
    depends_on:
      - postgres
    image: golang:stretch
    command: ["/start-postgres/dev/scripts/wait-for-it/wait-for-it.sh", "postgres:5432", "--", "/start-postgres/dev/setup-postgres/setup-postgres.sh"]
    volumes:
      - .:/start-postgres

  api:
    build: ./
    depends_on:
      - start-postgres
    environment:
      BASE_URI: api/
      PORT: 9999
      PG_HOST: postgres
      PG_DBNAME: yotas
      PG_USER: yotas
      PG_PASSWORD: yotas
      PG_PORT: 5432

    ports:
      - 9999:9999
